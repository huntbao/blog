---
title: NEI接口管理平台
category: presentation
tag: presentation, nei
permalink: nei
---
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>NEI平台使用教程</title>
  <meta name="author" content="HuntBao">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="/public/reveal/css/reveal.css">
  <link rel="stylesheet" href="/public/reveal/css/theme/black.css" id="theme">
  <!-- Code syntax highlighting -->
  <link rel="stylesheet" href="/public/reveal/lib/css/zenburn.css">
  <style>
    .tal {
      text-align: left;
      top: 0 !important;
    }

    .reveal pre {
      width: 100%;
    }

    .reveal pre code {
      border-radius: 5px;
      padding: 12px;
    }

    .reveal sup {
      font-size: 12px;
      margin: -8px 4px 0;
      vertical-align: top;
    }

    .reveal h2 {
      text-transform: none;
    }

    code {
      padding: .25em .1em;
      font-size: 85%;
      color: #bf616a;
    }

    .reveal blockquote {
      padding: 0 20px;
      border-radius: 5px;
    }

    .reveal section img {
      box-shadow: none;
    }
  </style>
  <base target="_blank">
</head>
<body>

<div class="reveal">

  <div class="slides">
    <section>
      <img src="/public/nei/logo.png" style="border:none;background:none;width:120px;">
      <h1>NEI平台使用教程</h1>
      <h3>规范化、自动化、云协作</h3>
      <p>
        <small><a href="https://github.com/huntbao">包勇明</a> / <a href="http://weibo.com/gzooler">@huntbao</a></small>
      </p>
    </section>

    <section class="tal">
      <h2>内容介绍</h2>
      <ul>
        <li>基本概念</li>
        <li>接口测试</li>
        <li>构建工具</li>
        <li>工程规范</li>
      </ul>
    </section>

    <section class="tal">
      <h2>基本概念</h2>
      <div data-markdown>
        * 项目组和项目
        * 项目资源
          * 数据模型
          * 异步接口
          * 页面
          * 页面模板
          * 规则函数
          * 业务分组
      </div>
    </section>

    <section class="tal">
      <h2>现代产品的基本形态</h2>
      <div data-markdown style="background: #fff;text-align: center;">
        ![](/public/nei/product-a.png)
      </div>
    </section>

    <section class="tal">
      <h2>项目组和项目</h2>
      <div data-markdown style="background: #fff;text-align: center; height: 90%;">
        ![](/public/nei/project-group.png)
      </div>
    </section>

    <section class="tal">
      <h2>项目组 - 默认分组</h2>
      <div data-markdown>
        * 用户首次登录时，系统会自动创建一个叫“默认分组”的项目组
      </div>
    </section>

    <section class="tal">
      <h2>项目组 - 创建者</h2>
      <div data-markdown>
        * 鼠标 hover 到项目组名称上，会显示该项目组的创建者
        * 在“团队管理”中也可以看到该项目组的创建者
      </div>
    </section>

    <section class="tal">
      <h2>项目组 - 锁定</h2>
      <div data-markdown>
        * 项目组被锁定后，切换到“只读”状态

        > 锁定后，项目引用的工程规范还能修改，工程规范也可以被锁定
      </div>
    </section>

    <section class="tal">
      <h2>项目组 - 团队管理</h2>
      <div data-markdown>
        * 创建好项目组后，在项目组的“团队管理”选项卡中，可以把其他人加到项目组中来

        >人是加到项目组上的，而不是在项目上

        >可以将其他项目组的成员一并导入
      </div>
    </section>

    <section class="tal">
      <h2>项目组 - 成员权限</h2>
      <div data-markdown>
        * 创建者：拥有所有操作权限
        * 管理员：拥有除删除项目组之外的所有操作权限
        * 开发者和测试者：拥有项目资源的所有操作权限，对项目组本身没有操作权限
        * 观察者：“只读”权限

        >除创建者外，其他角色都可以有多个
      </div>
    </section>

    <section class="tal">
      <h2>项目组 - 加入项目组</h2>
      <div data-markdown>
        * 访问没权限的项目组或者项目时，会出现“申请加入”的按钮
        * 点击“我的项目组”，在“我的申请列表”区域的搜索框中输入项目组或者项目的名称
      </div>
    </section>

    <section class="tal">
      <h2>项目组 - 公共资源库</h2>
      <div data-markdown>
        * 对于某个产品，有些资源对所有项目都是适用的，比如用户模型 User，登录接口等

        ```json
        /* User Model */

        {
          "id": "number",
          "name": "string",
          "email": "string"
        }
        ```

        * 公共资源库，用来存放所有项目共享的资源，避免创建重复资源，以达到资源复用的目的

        > 功能单一的资源才适合放到公共资源库
      </div>
    </section>

    <section class="tal">
      <h2>项目组 - 公共资源库</h2>
      <div data-markdown>
        * 在创建项目组的时候，系统会自动创建“公共资源库”
        * 公共资源库中的资源会出现在所有项目中

        >前面有黄色共享图标的表示是共享资源

        >公共资源库只有异步接口、数据模型和规则函数

        >`不要把公共资源库当作实际项目来使用`
      </div>
    </section>

    <section class="tal">
      <h2>项目组 - 共享资源</h2>
      <div data-markdown>
        * 项目中的异步接口、数据模型、规则函数可以共享
        * 资源被共享后，无法取消共享，操作时须谨慎

        > 共享资源的时候，还会将它所有引用的资源一并共享

        > 如果不小心共享了某个资源，可以把它复制到目标项目，然后再将其删除
      </div>
    </section>

    <section class="tal">
      <h2>数据模型</h2>
      <div data-markdown>
        * 最强大的功能之一，其他资源可以引用，是基础资源：
          * 对应数据库实体，比如 Project、Datatype 等
          * 复用，比如需要在多处使用的异步接口响应参数，它们有着相同的格式
        * 修改数据模型时，所有引用它的资源都会更新，换句话说，引用数据模型并不会产生新的数据模型，数据库只存了一份数据

        >需要一定的总结和抽象能力，才能正确合理地使用数据模型，并为之后的其他功能做好准备
      </div>
    </section>

    <section class="tal">
      <h2>数据模型 - 类别</h2>
      <div data-markdown>
        共有七大类别，涵盖了编程语言的常见数据类型：

        * 哈希
        * 枚举
        * 数组
        * 字符
        * 数值
        * 布尔
        * 文件
      </div>
    </section>

    <section class="tal">
      <h2>数据模型 - 哈希</h2>
      <div data-markdown>
        最常见的类型，比如 NEI 中的 Project:

        ```json
        /* Project Model */

        {
          "id": "[number]",
          "name": "[string]",
          "type": "[string]",
          "creator": "[user]",
          "createTime": "[number]",
          "progroupId": "[number]",
          "toolKey": "[string]",
          "description": "[string]"
        }
        ```

        > 字段的类型可以是任何数据模型，比如 creator 的类型是自定义类型 user
      </div>
    </section>

    <section class="tal">
      <h2>数据模型 - 哈希 - 创建方式</h2>
      <div data-markdown>
        * 在第一行的第一个输入框，粘贴 JSON 字符串
        * 点击“导入JSON”按钮，和上述功能相同
        * 导入其他数据模型：会将导入的字段当作一个整体来对待，详情页面也做了特殊显示处理
        * 从接口导入：会识别接口返回的 JSON 数据，支持 GET 和 POST 两种类型的接口
        * 从 JavaBean 导入
      </div>
    </section>

    <section class="tal">
      <h2>数据模型 - 枚举</h2>
      <div data-markdown>
        * 
      </div>
    </section>

    <section class="tal">
      <h2>数据模型（二）</h2>
      <div data-markdown>
        * 创建数据模型的时候，可以指定字段的默认值，默认值的优先级会高于 Mock 出来的随机数据。也可以定义生成规则，根据自己的逻辑生成 Mock 数据
      </div>
    </section>

    <section class="tal">
      <h2>数据模型（二）</h2>
      <div data-markdown>
        比如 User 对象，它的结构一般如下所示：
        ```json
        {
        "id": "[number]",
        "name": "[string]",
        "email": "[string]"
        }
        ```
        其中，中括号里面的值表示该字段的类型。

        创建了 User 数据模型后，整个系统就变得规范了，如果各个环节的代码都是严格按照 NEI 上的定义来实现的话，那么所有地方的 User 都是一致的，不会出现这里的 id 的类型和那里的不一致的情形，这固然有点理想主义，但也不是不能做到。这么做的好处是显而易见的，自动化测试方便了，甚至整个系统都可能变得更加严谨和正确。
      </div>
    </section>

    <section class="tal">
      <h2>数据模型（三）</h2>
      <div data-markdown>
        然后就可以在其他地方使用这个 User 对象。比如某个异步接口，输入参数是用户 id，要求返回的是 User 对象。接口开发者一看 NEI 上的定义就知道要返回什么样的数据，省去了很多沟通成本。

        刚才说的 User 对象，在 NEI 中称为哈希类型，其实就是大家常说的 Map 对象。另外还有 6 种类型：枚举、数组、字符、数值、布尔、文件，也很好理解。

        注意，在创建某个数据模型时，如果某个字段的类型是未知的，则选择 Variable 即可，表示可变类型，在具体使用的时候再指定它的类型。

        数据模型 一般对应服务端的 Model。
      </div>
    </section>

    <section class="tal">
      <h2>异步接口</h2>
      <div data-markdown>
        最核心的项目资源，它包含以下元素：

        * 请求地址、方式
        * 请求头信息
        * 请求参数
        * 发送规则
        * 响应头
        * 响应结果
        * 接收规则
      </div>
    </section>

    <section class="tal">
      <h2>异步接口 – 请求地址、方式</h2>
      <div data-markdown>
        和页面类似，请求地址也是相对地址。

        请求方式可以自定义，系统内置了常见的方式：GET、POST、DELETE、PUT、PATCH等
      </div>
    </section>

    <section class="tal">
      <h2>异步接口 – 请求头、请求参数</h2>
      <div data-markdown>
        请求头即在发送请求的时候添加到 Request Headers 中的参数

        请求数据即要发送的数据。NEI 默认的输入参数类型是一个哈希对象。我们知道 JSON 可以表示 4 种基本类型 (string，number，boolean 和 null) 和 2 种结构化类型 (object 和 array)。除了 null 之外，其他类型 NEI 都支持。
      </div>
    </section>

    <section class="tal">
      <h2>异步接口 – 响应头、响应参数</h2>
      <div data-markdown>
        响应头即服务器需要返回的头信息。

        返回结果即异步接口返回的数据，格式同输入参数。
      </div>
    </section>

    <section class="tal">
      <h2>异步接口 – 响应参数定义技巧</h2>
      <div data-markdown>
        一般我们希望输出参数具有某种固定格式，这样客户端就可以统一处理一些逻辑，比如 404、500 等异常。比如，可以先定义一个叫 ResultData 的数据模型，它的结构如下所示：
        ```json
        {
        "code": "[number]",
        "msg": "[string]",
        "result": "[Variable]"
        }
        ```
        code 是请求返回的状态码，msg 是返回的信息（比如一些异常信息），result 是真正的数据部分，定义数据模型的时候它是可变的。

        然后点击 导入 按钮，选择 ResultData，然后再选择 result 的具体类型，比如它是一个数组，数组的每一项都是一个 User 对象。
      </div>
    </section>

    <section class="tal">
      <h2>异步接口 – 发送、接收规则</h2>
      <div data-markdown>
        发送规则：在发送数据之前，对数据进行一些特殊处理，比如对密码进行加密等

        接收规则：在服务器返回数据后，对数据进行一些特殊处理后再返回给客户端脚本代码
      </div>
    </section>

    <section class="tal">
      <h2>页面</h2>
      <p>指可以通过地址访问的普通页面，它主要包含了：</p>
      <ul>
        <li>访问地址</li>
        <li>参数列表</li>
        <li>模板列表</li>
        <li>接口列表</li>
      </ul>
    </section>

    <section class="tal">
      <h2>页面 - 访问地址</h2>
      <p>在创建页面的时候，可以指定页面的访问地址，比如 /index，那么它的访问地址是: {host}/index。</p>
      <div data-markdown>
        >在填写访问地址的时候，只要写相对地址即可，host 的值由环境决定，比如在本地开发时，它的值就是 http://127.0.0.1 ；在测试环境时，它的值可能是 http://test.nei.netease.com
      </div>
    </section>

    <section class="tal">
      <h2>页面 - 参数列表</h2>
      <div data-markdown>
        有两种传递方式：

        * GET：通过 url 传入

        * POST：通过 form 表单

        比如，定义了参数 userId，此时页面的开发人员就知道，访问该页面的时候将会传入 userId 参数，即访问地址是：http://127.0.0.1?userId={userId} ，根据 userId 参数可以做一些相应的业务逻辑</p>
      </div>
    </section>

    <section class="tal">
      <h2>页面 - 模板列表</h2>
      <div data-markdown>
        * 每张页面至少有一个模板

        * 模板需要模板引擎来解析生成 html，常见的模板引擎有 freemarker、velocity、ejs 等

        * 创建时无需填写扩展名(.ftl、.vm、.ejs 等)，扩展名在工程规范中指定

        * 页面可以有多个模板，每个模板表示页面的某种状态，比如`成功`、`失败`等状态，服务端根据业务逻辑返回相应的模板

        >如果模板没有被页面引用，则构建工具不会生成这个模板文件
      </div>
    </section>

    <section class="tal">
      <h2>页面 - 接口列表</h2>
      <p>只是表明该页面会用到哪些异步接口</p>
    </section>

    <section class="tal">
      <h2>页面模板</h2>
      <div data-markdown>
        模板就是服务端的模板。

        一般模板里面会有很多变量需要使用真实数据来替换，在创建模板时，数据选项一栏指的就是这些真实的数据。数据一般就对应服务端的 Model，通过 Controller 提供给模板。
      </div>
    </section>

    <section class="tal">
      <h2>规则函数</h2>
      <div data-markdown>
        顾名思义，它们都是函数。在创建数据模型的属性或者异步接口的参数时，可以指定它们的生成规则，如果它们没有默认值，则会调用生成规则函数并将它的返回值作为最终的 Mock 数据。

        >注意：虽然数据模型的生成规则、异步接口的发送和接收规则都可以编写 JavaScript 脚本，但我们还是建议它们都是调用规则函数的代码，以达到复用的目的，管理和维护也更加方便
      </div>
    </section>

    <section class="tal">
      <h2>业务分组</h2>
      <div data-markdown>
        一个项目可以有多条业务线，业务分组可以用来更好地组织资源，它是唯一的。

        业务分组和标签有所不同，例如，资源可以有多个标签，但只能属于一个分组
      </div>
    </section>

    <section class="tal">
      <h2>工程规范</h2>
      <div data-markdown>
        工程规范定义了工程的初始化目录结构，在使用构建工具构建项目的时候，会按照定义好的目录和文件数据在本地生成相应的目录和文件。

        工程规范和项目的关联方式：在项目的"工具设置"中，我们可以分别指定项目的"WEB工程规范"、"AOS工程规范"、"iOS工程规范"以及"测试工程规范"
      </div>
    </section>

    <section class="tal">
      <h2>工程规范 - 实现原理</h2>
      <div data-markdown style="text-align: center;background: #fff;">
        ![工程规范 - 实现原理](/public/nei/spec.png)
      </div>
    </section>

    <section class="tal">
      <h2>工程规范 – 特殊目录（一）</h2>
      <div data-markdown>
        * 静态资源根目录：在使用本地模拟容器时，需要该信息，该目录用来存放静态资源

        * 模板根目录：在使用本地模拟容器时，需要该信息，该目录用来存放页面模板

        * 接口MOCK数据根目录：使用本工具生成的异步接口的mock数据会放到该目录下面
      </div>
    </section>

    <section class="tal">
      <h2>工程规范 – 特殊目录（二）</h2>
      <div data-markdown>
        * 模板MOCK数据根目录：使用本工具生成的页面模板的mock数据会放到该目录下面

        * JAR包根目录：存放自定义JAR包，ftl模板可以直接调用JAR包中的静态方法
      </div>
    </section>

    <section class="tal">
      <h2>工程规范 – 特殊文件（一）</h2>
      <div data-markdown>
        * 接口列表填充：使用项目中定义的异步接口数据列表作为数据源，每个异步接口都会生成一个文件

        * 数据模型列表填充：使用项目中定义的数据模型数据列表作为数据源，每个数据模型都会生成一个文件。为了保持通用性，我们区分了枚举类型和非枚举类型。如果需要使用枚类型的数据类型列表，需要在文件名后面加上`!!enum`

        * 页面模板列表填充：使用项目中定义的页面模板数据列表作为数据源，每个页面模板都会生成一个文件
      </div>
    </section>

    <section class="tal">
      <h2>工程规范 – 特殊文件（二）</h2>
      <div data-markdown>
        * 视图列表填充：使用项目中定义的视图数据列表作为数据源，每个视图都会生成一个文件

        * 命令行参数配置文件：该文件的内容须为有效的 json，它的值会作为本构建工具的命令行参数

        * 自定义Handlebars辅助函数：构建工具会运行这个文件，从而注册自定义方法
      </div>
    </section>

    <section class="tal">
      <h2>工程规范 – 模板数据</h2>
      <div data-markdown>
        传给模板的数据格式说明请参数 github 上面详细的说明：

        [传给模板的数据说明](https://github.com/NEYouFan/nei-toolkit/blob/master/doc/传给模板的数据说明.md)

        Handlebars 辅助函数集说明：

        [Handlebars辅助函数集](https://github.com/NEYouFan/nei-toolkit/blob/master/doc/Handlebars辅助函数集.md)
      </div>
    </section>

    <section class="tal">
      <h2>接口测试</h2>
      <div data-markdown>
        选中某个异步接口，可以新建测试用例

        测试用例可以保存下来，可以批量运行

        可以验证接口返回数据的正确性，目前会检测字段类型、期望值、字段缺失情况等
      </div>
    </section>

    <section>
      <h2>Thank You</h2>
      <h3>Q & A</h3>
      <p>
        <small><a href="https://github.com/huntbao">包勇明</a> / <a href="http://weibo.com/gzooler">@huntbao</a>
        </small>
      </p>
    </section>

  </div>
</div>

<script src="/public/reveal/lib/js/head.min.js"></script>
<script src="/public/reveal/js/reveal.js"></script>
<script>
  // Full list of configuration options available at:
  // https://github.com/hakimel/reveal.js#configuration
  Reveal.initialize({
    controls: true,
    progress: true,
    history: true,
    center: true,
    transition: 'slide', // none/fade/slide/convex/concave/zoom
    // Optional reveal.js plugins
    dependencies: [
      {
        src: '/public/reveal/lib/js/classList.js',
        condition: function () {
          return !document.body.classList;
        }
      },
      {
        src: '/public/reveal/plugin/markdown/marked.js',
        condition: function () {
          return !!document.querySelector('[data-markdown]');
        }
      },
      {
        src: '/public/reveal/plugin/markdown/markdown.js',
        condition: function () {
          return !!document.querySelector('[data-markdown]');
        }
      },
      {
        src: '/public/reveal/plugin/highlight/highlight.js',
        async: true,
        callback: function () {
          hljs.initHighlightingOnLoad();
        }
      },
      {src: '/public/reveal/plugin/zoom-js/zoom.js', async: true},
      {src: '/public/reveal/plugin/notes/notes.js', async: true}
    ]
  });
</script>
</body>
</html>
